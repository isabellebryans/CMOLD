@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix : <http://example.org/>.
@prefix sh: <http://www.w3.org/ns/shacl#> .


# SHACL-SPARQL shape to ensure that the piece that was moved belongs to the player who made the move.
:PlayerOwnsPieceShape a sh:NodeShape ;
           sh:targetClass :chessMove ;
           sh:sparql [
                 a          sh:SPARQLConstraint ;
                 sh:message "Player can only move a piece that belongs to them";
                 sh:prefixes [
                                sh:declare [
                                               sh:prefix    "ex" ;
                                               sh:namespace "http://example.org/"^^xsd:anyURI ;
                                           ]
                            ] ;
                 sh:select
                         """SELECT $this (ex:piece AS ?path) (?piece AS ?value)
                            WHERE {
                              $this ex:piece       ?piece .
                              $this ex:madeBy  ?player .
                              ?piece ex:belongsTo ?player1.
                              FILTER(?player != ?player1)
                         }""" ;
             ]
.

